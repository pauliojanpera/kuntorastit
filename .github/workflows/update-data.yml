name: Update Event Data

on:
  schedule:
    - cron: "0 */6 * * *"  # Runs every 6 hours
  workflow_dispatch:  # Allow manual triggering

jobs:
  update-json:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4

      - name: Fetch latest JSON data
        run: |
          mkdir -p public/data
          curl -s "https://www.rastilippu.fi/api/events/search/?topLeftLat=70.190068&topLeftLon=19.640624&bottomRightLat=59.741636&bottomRightLon=31.769532&dateTimeRangeStart=2025-04-15T00:00:00%2B03:00&dateTimeRangeEnd=2124-02-18T13:22:52%2B02:00&size=9999" -o public/data/events.json

      - name: Commit and push if changed
        run: |
          git config --global user.name "github-actions"
          git config --global user.email "github-actions@github.com"
          git add public/data/events.json
          git diff --quiet && git diff --staged --quiet || (git commit -m "Update JSON data" && git push)

      - name: Deploy to GitHub Pages
        uses: actions/deploy-pages@v2
